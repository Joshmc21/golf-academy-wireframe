<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Golf Academy – Wireframe</title>
<style>
  :root{
    --bg:#F3F3F3;
    --panel:#ffffff;
    --card:#ffffff;
    --border:#d9d9d9;
    --text:#000000;
    --muted:#555555;
    --accent:#FFBF00;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font:15px/1.5 'Helvetica Neue Light','Helvetica Neue',Helvetica,Arial,sans-serif}
  .app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
  .sidebar{border-right:1px solid var(--border);background:var(--panel);
           padding:16px;position:sticky;top:0;height:100vh}
  .logo img{width:100%;max-width:160px;margin-bottom:16px;display:block}
  .nav button{width:100%;text-align:left;padding:10px 12px;
              background:transparent;border:1px solid transparent;
              border-radius:10px;color:var(--text);cursor:pointer}
  .nav button:hover{background:var(--accent);color:#000}
  .main{padding:20px}
  .card{background:var(--card);border:1px solid var(--border);
        border-radius:14px;padding:14px;margin-bottom:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid var(--border)}
  .btn{padding:6px 10px;border:1px solid var(--border);
       border-radius:6px;background:#fff;cursor:pointer}
  .btn:hover{background:var(--accent)}
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  .muted{color:var(--muted)}
  .sparkwrap{display:flex;align-items:center;gap:10px}
  .spark{stroke:var(--accent);fill:none;stroke-width:2}
  .spark2{stroke:#000;fill:none;stroke-width:2;opacity:.6}
  .kpi{font-size:22px;font-weight:600}
  .badge-up{color:#0a7b00;font-weight:600}
  .badge-down{color:#b00020;font-weight:600}
  .badge-flat{opacity:.7}
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="logo">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA..." alt="ProPath Logo" />
    </div>
    <div id="whoami" class="muted">Not logged in</div>
    <div class="section">
      <h3>Role Panels</h3>
      <div class="nav">
        <button onclick="impersonate('golfer')">Impersonate Golfer</button>
        <button onclick="impersonate('coach')">Impersonate Coach</button>
        <button onclick="impersonate('admin')">Impersonate Admin</button>
      </div>
    </div>
    <div class="section">
      <h3>Navigate</h3>
      <div id="roleNav" class="nav"></div>
    </div>
  </aside>
  <main class="main">
    <div id="mainContent">
      <h1>Welcome</h1>
      <p>Select a role to begin exploring.</p>
    </div>
  </main>
</div>

<script>
/* ----------------------------------------------------------
   Deterministic demo data
---------------------------------------------------------- */
const RNG = (seed => () => (seed = (seed * 16807) % 2147483647) / 2147483647)(123456);
function rand(min, max){ return Math.round((min + (max-min)*RNG())*10)/10; }
function randi(min, max){ return Math.floor(min + (max-min+1)*RNG()); }

const QUARTERS = ["2024-10","2025-01","2025-04","2025-07"];
const FIRSTS = ["Millie","Jack","Ben","Louisa","Ollie","Oscar","Eli","Kye","Olivia","George","Harry","Tom","Evie","Charlie","Aidan","Lewi","Nate","Willow","Sam","Tyler","Thomas","Finley","Imogen","Poppy","Noah","Maya","Isaac","Ruby","Theo","Lily","Henry","Sofia","Leo"];
const LASTS  = ["Hixon","Harrison","Dobson","Hamilton","Porteous","Knowles","Gales","Bouttell","Metcalfe","Reed","Sheen","Hartshorne","Goodman","Curry","Robson","O’Rourke","Suggitt","Doherty","Scott","Perkins","Hudson","Hall","Marsden","Balderson","Parker","Hill","Stone","Bennett","Morris","Wright","Kelly","Brooks","Shaw","Foster","Cooper","James"];

function makeGolfer(i){
  const f = FIRSTS[i % FIRSTS.length];
  const l = LASTS[i % LASTS.length];
  const dobYear = randi(2008, 2014);
  const dob = `${dobYear}-${String(randi(1,12)).padStart(2,'0')}-${String(randi(1,28)).padStart(2,'0')}`;
  const age = 2025 - dobYear;
  const baseSG = rand(0.0, 2.0);
  const putt   = Math.max(-0.5, Math.min(1.2, rand(0.0, 0.8)));
  const hi     = Math.max(0, Math.round((8 - baseSG*2 + rand(-0.5,1.0))*10)/10);

  const sg = QUARTERS.map((q,idx)=>({
    d:q,
    total: Math.round((baseSG + (idx-2)*0.1 + rand(-0.2,0.2))*10)/10,
    tee:   Math.round((rand(-0.3,0.9))*10)/10,
    approach:Math.round((rand(-0.2,0.8))*10)/10,
    short: Math.round((rand(-0.2,0.6))*10)/10,
    putting: Math.round((putt + (idx-1)*0.05 + rand(-0.15,0.15))*10)/10
  }));

  const phys = QUARTERS.map((q,idx)=>{
    const chs = randi(92,108) + idx;
    const ball= chs + randi(40,46);
    return { d:q, chs, ball, cmj:randi(28,40), bj:randi(200,260), height: randi(150,190), weight:randi(45,85) };
  });

  const ratings = QUARTERS.map((q)=>({
    d:q, holing:randi(5,9), short:randi(5,9), wedge:randi(5,9), flight:randi(5,9), plan:randi(5,9)
  }));

  return { id:i+1, name:`${f} ${l}`, dob, age, hi, sg, phys, ratings };
}

const state = {
  golfers: Array.from({length:40}, (_,i)=>makeGolfer(i)),
  currentGolfer:null,
  role:null,
  loggedGolferId: 1, // treat golfer #1 as the logged-in user
  compare: {
    dateWindow: "This Cycle",
    columns: ["SG Total","SG Putting","Ball Speed","CHS"], // defaults
    sortKey: "sg_total",
    sortDir: -1 // -1 desc, 1 asc
  }
};

/* ----------------------------------------------------------
   Helpers
---------------------------------------------------------- */
function last(arr){ return arr[arr.length-1]; }
function avg(nums){ return Math.round((nums.reduce((a,b)=>a+b,0)/nums.length)*10)/10; }
function fmt(n){ return (n===null||n===undefined||Number.isNaN(n)) ? "—" : n; }
function qWindowDates(win){
  if(win==="This Cycle") return QUARTERS.slice(-1);
  if(win==="90 days")    return QUARTERS.slice(-1);
  if(win==="6 months")   return QUARTERS.slice(-2);
  return QUARTERS;
}
function delta(curr, prev){
  if(curr==null || prev==null || Number.isNaN(curr) || Number.isNaN(prev)) return null;
  return Math.round((curr - prev) * 10) / 10;
}
function deltaBadge(d){
  if(d===null) return "";
  if(d>0) return ` <span class="badge-up">+${d}</span>`;
  if(d<0) return ` <span class="badge-down">−${Math.abs(d)}</span>`;
  return ` <span class="badge-flat">±0</span>`;
}
function toCSV(rows){
  return rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
}
function download(filename, text){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([text],{type:'text/csv'}));
  a.download=filename; a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href),1000);
}
/* Simple SVG sparkline */
function sparkline(values, w=180, h=48, cls="spark"){
  if(!values || values.length===0) return "";
  const min = Math.min(...values), max = Math.max(...values);
  const pad = 6, innerW = w - pad*2, innerH = h - pad*2;
  const sx = i => pad + (i/(values.length-1))*innerW;
  const sy = v => pad + innerH - (values.length===1 ? innerH/2 : ((v-min)/(max-min||1))*innerH);
  const d = values.map((v,i)=> (i===0?`M ${sx(i)} ${sy(v)}`:`L ${sx(i)} ${sy(v)}`)).join(" ");
  return `<svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" aria-hidden="true">
    <path class="${cls}" d="${d}"/></svg>`;
}

/* ----------------------------------------------------------
   Navigation (with role guard)
---------------------------------------------------------- */
function nav(view) {
  const main = document.getElementById("mainContent");

  // coach-only guard
  const coachOnly = new Set(["compare","profile"]);
  if (coachOnly.has(view) && state.role !== "coach") {
    main.innerHTML = "<h1>Not authorized</h1><p>This view is only available to coaches.</p>";
    return;
  }

  if (view==="dashboard"){
    const g = state.golfers.find(x=>x.id===state.loggedGolferId) || state.golfers[0];
    const sgTotals = g.sg.map(s=>s.total);
    const physBall = g.phys.map(p=>p.ball);
    const physCHS  = g.phys.map(p=>p.chs);
    const ratingAvg= g.ratings.map(r=>avg([r.holing,r.short,r.wedge,r.flight,r.plan]));
    const nextUpdate = "2025-10-01";

    main.innerHTML = `
      <h1>Golfer Dashboard</h1>
      <div class="card"><strong>Welcome, ${g.name.split(" ")[0]}.</strong> Next required update: <b>${nextUpdate}</b>.</div>

      <div class="grid grid-3">
        <div class="card">
          <div class="kpi">${fmt(g.hi)} <span class="muted">HI</span></div>
          <div class="muted">Handicap Index (current)</div>
        </div>

        <div class="card" onclick="nav('sg-detail')" style="cursor:pointer" title="View SG details">
          <div class="sparkwrap">
            ${sparkline(sgTotals, 200, 48, "spark")}
            <div>
              <div class="kpi">${fmt(last(sgTotals))}</div>
              <div class="muted">SG Total (last 4) – click for detail</div>
            </div>
          </div>
        </div>

        <div class="card" title="Ball Speed (yellow) with CHS overlay (black)">
          <div class="sparkwrap">
            ${sparkline(physBall, 200, 48, "spark")}
            ${sparkline(physCHS, 200, 48, "spark2")}
            <div>
              <div class="kpi">${fmt(last(physBall))} <span class="muted">mph</span></div>
              <div class="muted">Ball Speed (overlay CHS)</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="sparkwrap">
            ${sparkline(ratingAvg, 200, 48, "spark")}
            <div>
              <div class="kpi">${fmt(last(ratingAvg))}</div>
              <div class="muted">Coach Rating (avg)</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Quick Links</h3>
          <div class="grid grid-2">
            <button class="btn" onclick="nav('my-profile')">My Profile</button>
            <button class="btn" onclick="nav('sg-detail')">SG Detail</button>
          </div>
        </div>
      </div>
    `;
    return;
  }

  if (view==="sg-detail"){
    const g = state.golfers.find(x=>x.id===state.loggedGolferId) || state.golfers[0];
    const rows = g.sg.map((s,idx)=>{
      const prev = g.sg[idx-1]?.total ?? null;
      const d = delta(s.total, prev);
      return `<tr><td>${s.d}</td><td>${fmt(s.total)}</td><td>${fmt(s.tee)}</td><td>${fmt(s.approach)}</td><td>${fmt(s.short)}</td><td>${fmt(s.putting)}</td><td>${deltaBadge(d)}</td></tr>`;
    }).join("");
    main.innerHTML = `
      <h1>Strokes Gained – Detail</h1>
      <div class="card">
        ${sparkline(g.sg.map(s=>s.total), 380, 60, "spark")}
        <div class="muted">SG Total trend (last 4 quarters)</div>
      </div>
      <div class="card">
        <table class="table">
          <thead><tr><th>Date</th><th>Total</th><th>Tee</th><th>Approach</th><th>Short</th><th>Putting</th><th>Δ Total</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
      <button class="btn" onclick="nav('dashboard')">Back to Dashboard</button>
    `;
    return;
  }

  if (view==="my-profile"){
    const g = state.golfers.find(x=>x.id===state.loggedGolferId) || state.golfers[0];
    const physRows = g.phys.map(p=>`<tr><td>${p.d}</td><td>${p.chs}</td><td>${p.ball}</td><td>${p.cmj}</td><td>${p.bj}</td><td>${p.height}</td><td>${p.weight}</td></tr>`).join("");
    const rateRows = g.ratings.map(r=>`<tr><td>${r.d}</td><td>${r.holing}</td><td>${r.short}</td><td>${r.wedge}</td><td>${r.flight}</td><td>${r.plan}</td></tr>`).join("");
    const sgRows   = g.sg.map(s=>`<tr><td>${s.d}</td><td>${s.total}</td><td>${s.tee}</td><td>${s.approach}</td><td>${s.short}</td><td>${s.putting}</td></tr>`).join("");
    document.getElementById("mainContent").innerHTML = `
      <h1>My Profile</h1>
      <div class="card"><strong>Name:</strong> ${g.name} &nbsp;|&nbsp; <strong>HI:</strong> ${fmt(g.hi)} &nbsp;|&nbsp; <strong>Age:</strong> ${g.age}</div>
      <div class="card"><h2>Physical Trends</h2><table class="table"><thead><tr><th>Date</th><th>CHS</th><th>Ball</th><th>CMJ</th><th>BJ</th><th>Height</th><th>Weight</th></tr></thead><tbody>${physRows}</tbody></table></div>
      <div class="card"><h2>Coach Rating Trends</h2><table class="table"><thead><tr><th>Date</th><th>Holing</th><th>Short</th><th>Wedge</th><th>Flight</th><th>Plan</th></tr></thead><tbody>${rateRows}</tbody></table></div>
      <div class="card"><h2>SG History</h2><table class="table"><thead><tr><th>Date</th><th>Total</th><th>Tee</th><th>Approach</th><th>Short</th><th>Putting</th></tr></thead><tbody>${sgRows}</tbody></table></div>
      <button class="btn" onclick='nav("dashboard")'>Back to Dashboard</button>
    `;
    return;
  }

  if (view==="compare"){ renderCompare(main); return; }

  if (view==="profile"){ // coach-only profile
    const g = state.currentGolfer;
    if(!g){ main.innerHTML = "<p>No golfer selected.</p>"; return; }
    const physRows = g.phys.map(p=>`<tr><td>${p.d}</td><td>${p.chs}</td><td>${p.ball}</td><td>${p.cmj}</td><td>${p.bj}</td><td>${p.height}</td><td>${p.weight}</td></tr>`).join("");
    const rateRows = g.ratings.map(r=>`<tr><td>${r.d}</td><td>${r.holing}</td><td>${r.short}</td><td>${r.wedge}</td><td>${r.flight}</td><td>${r.plan}</td></tr>`).join("");
    const sgRows   = g.sg.map(s=>`<tr><td>${s.d}</td><td>${s.total}</td><td>${s.tee}</td><td>${s.approach}</td><td>${s.short}</td><td>${s.putting}</td></tr>`).join("");
    main.innerHTML = `
      <h1>${g.name} – Profile</h1>
      <div class="card"><strong>Handicap:</strong> ${fmt(g.hi)} | <strong>Age:</strong> ${g.age}</div>
      <div class="card"><h2>Physical Trends</h2><table class="table"><thead><tr><th>Date</th><th>CHS</th><th>Ball</th><th>CMJ</th><th>BJ</th><th>Height</th><th>Weight</th></tr></thead><tbody>${physRows}</tbody></table></div>
      <div class="card"><h2>Coach Rating Trends</h2><table class="table"><thead><tr><th>Date</th><th>Holing</th><th>Short</th><th>Wedge</th><th>Flight</th><th>Plan</th></tr></thead><tbody>${rateRows}</tbody></table></div>
      <div class="card"><h2>SG History</h2><table class="table"><thead><tr><th>Date</th><th>Total</th><th>Tee</th><th>Approach</th><th>Short</th><th>Putting</th></tr></thead><tbody>${sgRows}</tbody></table></div>
      <button class="btn" onclick='nav("compare")'>Back to Compare</button>
    `;
    return;
  }

  // fallback
  main.innerHTML = `<h1>${view}</h1><p>Placeholder view.</p>`;
}

/* Role nav */
function impersonate(role){
  state.role = role;
  document.getElementById("whoami").textContent="Role: "+role;
  const roleNav=document.getElementById("roleNav"); roleNav.innerHTML="";
  let pages=[];
  if(role==="coach") pages=["Compare"];
  else if(role==="golfer") pages=["Dashboard","SG Detail","My Profile"];
  else if(role==="admin") pages=["Users","Compliance"]; // placeholders
  pages.forEach(p=>{
    const b=document.createElement("button");
    b.textContent=p;
    b.onclick=()=>nav(p.toLowerCase().replace(/ /g,"-"));
    roleNav.appendChild(b);
  });
  if(pages.length) nav(pages[0].toLowerCase().replace(/ /g,"-"));
}
function openProfile(id){ state.currentGolfer=state.golfers.find(x=>x.id===id); nav("profile"); }

/* ----------------------------------------------------------
   Coach → Compare (sortable + deltas + rank)
---------------------------------------------------------- */
function renderCompare(main){
  const colsAll = ["HI","SG Total","SG Putting","SG Tee","SG Approach","SG Short","Ball Speed","CHS","CMJ","BJ","Height","Weight"];
  const selected = new Set(state.compare.columns);
  const dateWin = state.compare.dateWindow;
  const lastDates = qWindowDates(dateWin);

  // rows with current & previous values for deltas
  const rows = state.golfers.map(g=>{
    const sgW = g.sg.filter(s=> lastDates.includes(s.d));
    const phW = g.phys.filter(p=> lastDates.includes(p.d));
    const sgC = sgW[sgW.length-1] || last(g.sg);
    const sgP = sgW[sgW.length-2] || g.sg[g.sg.length-2] || null;
    const phC = phW[phW.length-1] || last(g.phys);
    const phP = phW[phW.length-2] || g.phys[g.phys.length-2] || null;
    return {
      id:g.id, name:g.name, hi:g.hi,
      sg_total: sgC?.total ?? null, d_sg_total: delta(sgC?.total, sgP?.total ?? null),
      sg_putt:  sgC?.putting ?? null, d_sg_putt:  delta(sgC?.putting, sgP?.putting ?? null),
      sg_tee:   sgC?.tee ?? null,     d_sg_tee:   delta(sgC?.tee, sgP?.tee ?? null),
      sg_app:   sgC?.approach ?? null,d_sg_app:   delta(sgC?.approach, sgP?.approach ?? null),
      sg_short: sgC?.short ?? null,   d_sg_short: delta(sgC?.short, sgP?.short ?? null),
      ball:     phC?.ball ?? null,    d_ball:     delta(phC?.ball, phP?.ball ?? null),
      chs:      phC?.chs ?? null,     d_chs:      delta(phC?.chs, phP?.chs ?? null),
      cmj:      phC?.cmj ?? null,     d_cmj:      delta(phC?.cmj, phP?.cmj ?? null),
      bj:       phC?.bj ?? null,      d_bj:       delta(phC?.bj,  phP?.bj ?? null),
      height:   phC?.height ?? null,  d_height:   delta(phC?.height, phP?.height ?? null),
      weight:   phC?.weight ?? null,  d_weight:   delta(phC?.weight, phP?.weight ?? null)
    };
  });

  // sorting
  let sortKey = state.compare.sortKey || "sg_total";
  let sortDir = state.compare.sortDir ?? -1;
  function sortRows(){
    rows.sort((a,b)=>{
      const va=a[sortKey], vb=b[sortKey];
      if(va==null && vb==null) return 0;
      if(va==null) return 1;
      if(vb==null) return -1;
      return sortDir * (va - vb);
    });
  }
  sortRows();

  const renderHeader = (label)=> selected.has(label) ? `<th>${label}</th>` : "";
  const renderCellNoDelta = (label, value)=> selected.has(label) ? `<td>${fmt(value)}</td>` : "";
  const renderCellDelta   = (label, value, dkey, row)=> selected.has(label) ? `<td>${fmt(value)}${deltaBadge(row[dkey])}</td>` : "";

  function render(){
    const sortOpts = [
      {label:"HI", key:"hi"},
      {label:"SG Total", key:"sg_total"},
      {label:"SG Putting", key:"sg_putt"},
      {label:"SG Tee", key:"sg_tee"},
      {label:"SG Approach", key:"sg_app"},
      {label:"SG Short", key:"sg_short"},
      {label:"Ball Speed", key:"ball"},
      {label:"CHS", key:"chs"},
      {label:"CMJ", key:"cmj"},
      {label:"BJ", key:"bj"},
      {label:"Height", key:"height"},
      {label:"Weight", key:"weight"}
    ].filter(o => o.label==="HI" || selected.has(o.label));

    main.innerHTML = `
      <h1>Compare Golfers</h1>
      <div class="card" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <label>Date Window:
          <select id="cmpWin">
            ${["This Cycle","90 days","6 months","All"].map(w=>`<option ${w===dateWin?"selected":""}>${w}</option>`).join("")}
          </select>
        </label>

        <label>Sort by:
          <select id="cmpSort">
            ${sortOpts.map(o=>`<option value="${o.key}" ${o.key===sortKey?"selected":""}>${o.label}</option>`).join("")}
          </select>
        </label>

        <label><input type="checkbox" id="cmpAsc" ${sortDir===1?"checked":""}/> Ascending</label>

        <details>
          <summary style="cursor:pointer">Columns</summary>
          <div style="display:flex;gap:14px;flex-wrap:wrap;margin-top:8px">
            ${colsAll.map(c=>`<label><input type="checkbox" ${selected.has(c)?"checked":""} data-col="${c}"/> ${c}</label>`).join("")}
          </div>
        </details>

        <button class="btn" onclick="__cmpCSV()">Export CSV</button>
      </div>

      <div class="card" style="overflow:auto">
        <table class="table">
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              ${renderHeader("HI")}
              ${renderHeader("SG Total")}
              ${renderHeader("SG Putting")}
              ${renderHeader("SG Tee")}
              ${renderHeader("SG Approach")}
              ${renderHeader("SG Short")}
              ${renderHeader("Ball Speed")}
              ${renderHeader("CHS")}
              ${renderHeader("CMJ")}
              ${renderHeader("BJ")}
              ${renderHeader("Height")}
              ${renderHeader("Weight")}
              <th>Profile</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map((r,i)=>`
              <tr>
                <td>${i+1}</td>
                <td>${r.name}</td>
                ${renderCellNoDelta("HI",r.hi)}
                ${renderCellDelta("SG Total",r.sg_total,"d_sg_total",r)}
                ${renderCellDelta("SG Putting",r.sg_putt,"d_sg_putt",r)}
                ${renderCellDelta("SG Tee",r.sg_tee,"d_sg_tee",r)}
                ${renderCellDelta("SG Approach",r.sg_app,"d_sg_app",r)}
                ${renderCellDelta("SG Short",r.sg_short,"d_sg_short",r)}
                ${renderCellDelta("Ball Speed",r.ball,"d_ball",r)}
                ${renderCellDelta("CHS",r.chs,"d_chs",r)}
                ${renderCellDelta("CMJ",r.cmj,"d_cmj",r)}
                ${renderCellDelta("BJ",r.bj,"d_bj",r)}
                ${renderCellDelta("Height",r.height,"d_height",r)}
                ${renderCellDelta("Weight",r.weight,"d_weight",r)}
                <td><button class="btn" onclick="openProfile(${r.id})">View</button></td>
              </tr>`).join("")}
          </tbody>
        </table>
      </div>
    `;

    // controls
    document.getElementById("cmpWin").onchange = e=>{
      state.compare.dateWindow=e.target.value; renderCompare(main);
    };
    document.getElementById("cmpSort").onchange = e=>{
      state.compare.sortKey = e.target.value; sortKey = state.compare.sortKey; sortRows(); render();
    };
    document.getElementById("cmpAsc").onchange = e=>{
      state.compare.sortDir = e.target.checked ? 1 : -1; sortDir = state.compare.sortDir; sortRows(); render();
    };
    main.querySelectorAll('input[type="checkbox"][data-col]').forEach(cb=>{
      cb.onchange=e=>{
        const col=e.target.getAttribute("data-col");
        if(e.target.checked) selected.add(col); else selected.delete(col);
        state.compare.columns = Array.from(selected);
        render();
      };
    });
  }

  // CSV export
  window.__cmpCSV = function(){
    const head = ["Rank","Name", ...colsAll.filter(c=>selected.has(c))];
    const body = rows.map((r,i)=>{
      const map = {
        "HI":r.hi, "SG Total":r.sg_total, "SG Putting":r.sg_putt,
        "SG Tee":r.sg_tee, "SG Approach":r.sg_app, "SG Short":r.sg_short,
        "Ball Speed":r.ball, "CHS":r.chs, "CMJ":r.cmj, "BJ":r.bj,
        "Height":r.height, "Weight":r.weight
      };
      return [i+1, r.name, ...colsAll.filter(c=>selected.has(c)).map(c=>map[c])];
    });
    download("compare.csv", toCSV([head, ...body]));
  };

  render();
}
</script>
</body>
</html>
